---
title: 8-淘宝爬虫
date: 2018-03-11 13:41:40
tags:
---
春招开始了...心里慌得一批...不过还是要保持记录blog的习惯,这两天在研究淘宝的爬虫,之前觉得很简单,实际去写难爆了,目前只完成了淘宝部分,并且未进行优化,天猫商品部分有待研究.
想着继续学习scrapy,并且利用scrapy的异步优势,就不用去学习...没想到大大增加了初步学习的难度.
真的是纸上谈来终觉浅,绝知此事要躬行.
以下是爬虫相关
<!--more-->
初步思路:
因为是初学者,所以没想着爬取全站商品信息,就以商品关键词为展开,爬取淘宝/天猫商品.
将所爬取的信息以dict方式保存入mongodb数据库

关于某种商品的所有信息,大概需要进行3次访问,第一次访问商品检索页,获取包含该关键字所有商品粗略信息(当页),其包括:
```
goods_id   #商品id
goods_type  #商品类型
goods_title #商品名称
goods_url = #商品链接
goods_sales #付款人数
goods_price #首页价格
goods_shop  #商家
goods_addr  #商家地区
```
第二次访问某一商品的具体详情页,可以获取以下所需信息:
```
goods_d_skuid  #商品详细型号id
goods_d_title  #商品详细型号标题
goods_d_names  #商品详细name
```
由于商品价格是ajax动态生成,所以需要进行第三次访问其api,获得某一商品具体型号的以下信息
```
goods_d_pre_price #商品详细原格
goods_d_now_price #商品详细现价
goods_d_quantity  #商品库存
```

淘宝和天猫的信息获取方式基本一致,都是利用正则表达式匹配访问返回的响应,利用json库将其字典化,只是详细信息获取的api不同
淘宝和天猫最大的不同,也是天猫最大的难点在于其cookie的需要(可能是其他原因),无论是访问其商品详情页,还是其价格api,都需要cookie
然而,在进行一定次数的访问api后,应该是cookie失效,出现验证码页面,导致爬虫失败


待优化:
优化商品名称检索,由每一个商品的具体型号title每次进行一次正则匹配data-value组合,改为提前进行data-value正则匹配,提取出一个集合,再根据商品的data-value组成商品具体型号title
增加分布式爬取提高效率,建立cookie池,完善天猫爬取部分.
在进行一定数量爬取后验证是否需要增加以下措施
使用代理ip池,绑定cookie?
使用随机ua.